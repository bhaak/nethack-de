#!/usr/bin/env ruby
Encoding.default_internal = Encoding::ISO_8859_1
Encoding.default_external = Encoding::ISO_8859_1

translated = []
File.open("german_vocabulary.c") { |german|
  translated = german.readlines.collect { |l|
    if l =~ /\{"[^"]*", "([A-Z0-9_]+)"/ then
      $1
    end
  }.uniq
}

t = []
files = []
if ARGV.length == 0 then
  files = Dir.glob("*.c") - %w{german.c german_test.c german_vocabulary.c german_wishing_test.c}
else
  files = ARGV
end

files.each { |f|
  File.open(f) { |file|
    tmp = file.readlines.collect {|l|
      l.scan(/"[^"]*[A-Z][A-Z0-9_]+[^"]*"/)
      #l.scan(/.*[A-Z][A-Z0-9_].*/) # fuer dat/quest.txt
    }
    t << tmp.flatten.collect {|l|
      l.scan(/[A-Z][A-Z0-9_]+/)
    }
  }
}

terme = [
"(ARROW|BEAR)_TRAP",
"(LEFT|RIGHT)_SIDE",
"(WEAPON|WAND|GEM)_CLASS",
"ABCDEF",
"ABCDEFGHIJKLMNOPQRSTUVWXYZ",
"AC",
"ACURR",
"ADJEKTIV_",
"AD_(ACID|COLD|CONF|DISN|DRST|ELEC|FIRE)",
"AE",
"AEIOU",
"AEXE",
"AIR",
"ALIGN_TOP",
"ALTAR",
"AND",
"ANGRY",
"ARTICLE_A",
"ARTICLE_NONE",
"ARTICLE_THE",
"ARTICLE_YOUR",
"ARTIKEL_",
"ASCENDED",
"ASCII",
"AT",
"AT386",
"ATR_BOLD",
"ATR_INVERSE",
"ATR_NONE",
"ATR_ULINE",
"AT_(BITE|EXPL|GAZE|HUGS|KICK|TUCH)",
"AUS",
"AUTOPICKUP_EXCEPTION",
"A_(|CHA|Y)",
"A_CHAOTIC",
"A_CON",
"A_DEX",
"A_LAWFUL",
"A_NEUTRAL",
"A_NONE",
"A_ORIGINAL",
"A_STR",
"A_WIS",
"BGPENS",
"BIOS",
"BLCORNER",
"BLINDFOLD",
"BONESDIR",
"BONUS",
"BOOM",
"BOTH_SIDES",
"BOULDER",
"BRCORNER",
"BROADSWORD",
"BR_NO_END1",
"BR_NO_END2",
"BR_PORTAL",
"BR_STAIR",
"BSTRCMP",
"BSTRCMPI",
"BUMM",
"BURNING_OIL",
"BY_YOU",
"C_",
"CANNOT",
"CATNAME",
"CATS",
"CHARACTER",
"CHOKING",
"CLOUD",
"COLNO",
"CONFIGDIR",
"CONFIGPREFIX",
"CORR",
"CRASH",
"CREAM_PIE",
"CROSSWALL",
"DAS",
"DATADIR",
"DBWALL",
"DE",
"DEAD",
"DEC",
"DEFINE",
"DEPTH",
"DICH",
"DIED",
"DISP_IN_GAME",
"DOGNAME",
"DOOR",
"DOORMAX",
"DOS",
"DO_MOVE",
"DRAWBRIDGE_DOWN",
"DRAWBRIDGE_UP",
"DRIPENS",
"DU",
"DUNGEON",
"DUST",
"D_BROKEN",
"D_ISOPEN",
"D_LOCKED",
"D_NODOOR",
"EFFECTS",
"EFGIOVW",
"EIGENTLICH",
"EIN",
"EN",
"ENGINE",
"ENGR_BLOOD",
"EOF",
"ESHK",
"EXPLOSION",
"E_",
"FACE",
"FALSE",
"FGPENS",
"FILE",
"FINGER",
"FINGERTIP",
"FL",
"FLAIL",
"FLESH",
"FONT",
"FOOD_CLASS",
"FOOD_RATION",
"FOOT",
"FOUNTAIN",
"FRIEDEN",
"GET",
"GLAIVE",
"GLASS",
"GOETTIN",
"GOING",
"GOLD",
"GOLD_PIECE",
"GOTT",
"GRAPHICS",
"HACKDIR",
"HACKOPTIONS",
"HAND",
"HANDED",
"HC",
"HD",
"HEAD",
"HELMET",
"HF",
"HHGTTG",
"HI",
"HJKL",
"HOLE",
"HOME",
"HP",
"HS",
"HT",
"HUP",
"HW",
"HWALL",
"IBM",
"IBM_",
"ICE",
"II",
"IMMEDIATE",
"IN",
"INTRINSIC",
"IS_ROCK",
"IS_TREE",
"ISO",
"KAABLAMM",
"KABOOM",
"KABUMM",
"KABUUUM",
"KADOOM",
"KARACH",
"KASUS_(NOMINATIV|GENITIV|DATIV|AKKUSATIV)",
"KEINE",
"KILLED_BY",
"KILLED_BY_AN",
"KILLED_WITHOUT_PREPOSITION",
"KNIFE",
"KRACH",
"KRACHEN",
"KRIEG",
"LADDER",
"LAST_GEM",
"LAVAPOOL",
"LEATHER_GLOVES",
"LEG",
"LEVELDIR",
"LEVELS",
"LIGHT_HEADED",
"LOCKDIR",
"LOCKS",
"LOCK_PICK",
"LOOO",
"LRS",
"LTST",
"LUNG",
"M2_DEMON",
"MAIL",
"MAILREADER",
"MALUS",
"MAXRECT",
"MAXSPELL",
"MAX_ERODE",
"MAZEWALK",
"MENSCH",
"MENUCOLOR",
"MENUPENS",
"MENU_UNSELECTED",
"MESG",
"MFAST",
"MIN_QUEST_LEVEL",
"MOAT",
"MODIFIER_ADJEKTIV_ADVERBIAL",
"MODIFIER_CORPSE",
"MODIFIER_EIGENNAME",
"MODIFIER_KONJUNKTIV_II",
"MODIFIER_NEBENSATZ",
"MODIFIER_PSEUDO_SUBJECT",
"MODIFIER_VERB_DRITTE_PERSON",
"MODIFIER_VERB_IMPERATIV",
"MODIFIER_VERB_INFINITIV",
"MODIFIER_VERB_PARTIZIP_PERFEKT",
"MODIFIER_VERB_PLURAL",
"MODIFIER_VERB_PRAETERITUM",
"MODIFIER_VERB_SINGULAR",
"MODIFIER_VERB_SUBSTANTIVIERT",
"MODIFIER_VERB_ZWEITE_PERSON",
"MONSTERS",
"MON_WEP",
"MSGPENS",
"MSG_MAIL",
"MSG_OTHER",
"MSLOW",
"MY",
"NAME",
"NEARDATA",
"NEST",
"NETHACKOPTIONS",
"NEUER_SATZ",
"NEUES_OBJECT",
"NEUES_OBJEKT",
"NEVER",
"NH_(GOLDEN|BLACK|RED|WHITE)",
"NH_HEAPLOG",
"NICHT",
"NO",
"NON_PM",
"NOSE",
"NOUN_",
"NOUN_GEM_",
"NOUN_HALB",
"NOUN_HIGH_",
"NOUN_LEATHER_ARM",
"NOUN_PRONOMEN_3P_MFN_PERSONAL",
"NOUN_PSEUDO_(WEIBLICH|MAENNLICH)",
"NOUN_RIDING_",
"NOUN_RING_UNIDENTIFIED_",
"NOUN_SCHADENS",
"NOUN_SCR_DESTROY_",
"NOUN_SCR_ENCHANT_",
"NOUN_STUDDED_LEATHER_ARM",
"NOUN_WAFFEN_",
"NOUN_WATCH",
"NO_GLYPH",
"NO_KILLER_PREFIX",
"NUMERUS_(SINGULAR|PLURAL)",
"OBJECT",
"OBJECTS",
"OFF",
"OK",
"ON",
"OPEN",
"OPTIONS",
"OTHERPENS",
"PANICKED",
"PAPER",
"PARTIKEL_OF",
"PATH",
"PATTERN",
"PEACE",
"PENS",
"PF",
"PFLATSCH",
"PID",
"PIT",
"PLATE_MAIL",
"PLAYER_FREMDER",
"PLAYER_GAUNER",
"PLAYER_INFIDEL",
"PLAYER_PILGER",
"PLAYER_SCHURKE",
"PLAYER_STERBLICHER",
"PL_FSIZ",
"PL_PSIZ",
"PM_",
"PM_(ARCHEOLOGIST|BARBARIAN|FIRE_ELEMENTAL|MONK|ROPE_GOLEM|GREEN_SLIME|HUMAN_WERERAT)",
"POISONING",
"POOHBAH",
"POOL",
"POT_ACID",
"POT_BOOZE",
"PREFIX",
"PREMATURE",
"PRIEST",
"PRIESTESS",
"PRONOMEN_",
"PRONOMEN_POSSESSIV_SUBJECT",
"P_BASIC",
"P_EXPERT",
"P_FIRST_H_TO_H",
"P_FIRST_SPELL",
"P_FIRST_WEAPON",
"P_GRAND_MASTER",
"P_LAST_H_TO_H",
"P_LAST_SPELL",
"P_LAST_WEAPON",
"P_MASTER",
"P_MAX_SKILL",
"P_SKILL",
"P_SKILLED",
"P_UNSKILLED",
"QT_ASSIGNQUEST",
"QT_BADALIGN",
"QT_BADLEVEL",
"QT_COMPACT",
"QT_DISCOURAGE",
"QT_ENCOURAGE",
"QT_FIRSTACQUIRE",
"QT_FIRSTLEADER",
"QT_FIRSTLOCATE",
"QT_FIRSTNEMESIS",
"QT_FIRSTTIME",
"QT_FONTSIZE",
"QT_GOTIT",
"QT_GUARDTALK",
"QT_GUARDTALK2",
"QT_HASAMULET",
"QT_KILLEDNEM",
"QT_LASTLEADER",
"QT_NEMWANTSIT",
"QT_NEXTACQUIRE",
"QT_NEXTLEADER",
"QT_NEXTLOCATE",
"QT_NEXTNEMESIS",
"QT_NEXTTIME",
"QT_OFFEREDIT",
"QT_OFFEREDIT2",
"QT_OTHERLEADER",
"QT_OTHERNEMESIS",
"QT_OTHERTIME",
"QT_POSTHANKS",
"QT_TILEHEIGHT",
"QT_TILEWIDTH",
"QUEST",
"QUIT",
"QWERTY",
"RA",
"RAMDISK",
"REST",
"RK",
"ROCK_CLASS",
"ROGUEOPTS",
"ROLE",
"ROLE_CHAOTIC",
"ROLE_LAWFUL",
"ROLE_NEUTRAL",
"ROOM",
"RUHE",
"RUMMS",
"RRUMMS",
"S_OF_",
"SATZBEGINN",
"SATZKLAMMER",
"SAVE",
"SAVEDIR",
"SCCS",
"SCHMERZEN",
"SCOREDIR",
"SCORR",
"SCREENMODE",
"SCROLL_CLASS",
"SDOOR",
"SET_IN_FILE",
"SET_IN_GAME",
"SHOPTYPE",
"SHORT_SWORD",
"SINK",
"SIZE",
"SO",
"SOUND",
"SOUNDDIR",
"SPAWN",
"SPE_BOOK_OF_THE_DEAD",
"SPE_EXTRA_HEALING",
"SPIKED_PIT",
"SPINE",
"SPLASH",
"SPLEVTYPE",
"SQKY_BOARD",
"STAIRS",
"STATIC_VAR",
"STATUE",
"STATUE_HISTORIC",
"STATUSCOLOR",
"STATUSPENS",
"STOMACH",
"STONE",
"SUBJECT",
"SUBJECT_IM_SATZ",
"SUPPRESS_SADDLE",
"S_FUNGUS",
"S_HUMAN",
"TDWALL",
"TERM",
"TEST",
"TEXT",
"TEXTPENS",
"THIS",
"THRONE",
"THUD",
"TLCORNER",
"TLWALL",
"TM",
"TO",
"TODO",
"TONE",
"TOWEL",
"TP",
"TRAPDOOR",
"TRAPS",
"TRCORNER",
"TRIED",
"TROUBLEDIR",
"TRUE",
"TRWALL",
"TT_(LAVA|WEB)",
"TT_INFLOOR",
"TUWALL",
"UNIQUE",
"UTF",
"UTF8",
"VA_ARGS",
"VEGGY",
"VER",
"VERB_",
"VWALL",
"V_",
"WARNINGS",
"WATER",
"WAX",
"WC",
"WEB",
"WEN",
"WHAMMM",
"WINTYPELEN",
"WIN_MAP",
"WIZKIT",
"WOOD",
"WOODEN_HARP",
"WORN_TYPES",
"WRONG",
"W_RING.",
"X11",
"Y2K",
"ZOT",
"ZT_(COLD|DEATH|FIRE)",
]

regexp = Regexp.new("^("+terme.join('|')+")$")
t = t.flatten.reject {|e|
  regexp.match(e)
}

puts (t.flatten - translated).sort.uniq

untranslated_tokens = (t.flatten - translated).uniq.length
puts untranslated_tokens

exit untranslated_tokens
